<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Cluster Refinement | 21,578 Reuters’ Newswires</title>
  <meta name="description" content="6 Cluster Refinement | 21,578 Reuters’ Newswires" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Cluster Refinement | 21,578 Reuters’ Newswires" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="shainarace/Reuters" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Cluster Refinement | 21,578 Reuters’ Newswires" />
  
  
  

<meta name="author" content="Shaina Race Bennett, PhD" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-grand-visualization.html"/>
<link rel="next" href="umap-of-full-sparse-matrix-in-python.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a style="font-weight:bold, text-align:center" href="https://github.com/shainarace/Reuters">Shaina Race Bennett, PhD</a>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prepare Data</a></li>
<li class="chapter" data-level="2" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html"><i class="fa fa-check"></i><b>2</b> Exploratory Analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#term-frequencies"><i class="fa fa-check"></i><b>2.1</b> Term Frequencies</a>
<ul>
<li class="chapter" data-level="" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#documents-per-word"><i class="fa fa-check"></i>Documents per word</a></li>
<li class="chapter" data-level="" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#words-per-doc"><i class="fa fa-check"></i>Words per doc</a></li>
<li class="chapter" data-level="" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#tf-idf-per-word"><i class="fa fa-check"></i>TF-IDF per word</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#via-svd"><i class="fa fa-check"></i><b>2.2</b> via SVD</a>
<ul>
<li class="chapter" data-level="" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#screeplot"><i class="fa fa-check"></i>Screeplot</a></li>
<li class="chapter" data-level="" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html#d-projection"><i class="fa fa-check"></i>2-D Projection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="umap.html"><a href="umap.html"><i class="fa fa-check"></i><b>3</b> UMAP</a></li>
<li class="chapter" data-level="4" data-path="clustering-hdbscan.html"><a href="clustering-hdbscan.html"><i class="fa fa-check"></i><b>4</b> Clustering: HDBSCAN</a></li>
<li class="chapter" data-level="5" data-path="the-grand-visualization.html"><a href="the-grand-visualization.html"><i class="fa fa-check"></i><b>5</b> The Grand Visualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-grand-visualization.html"><a href="the-grand-visualization.html#omit-some-noise-points-for-more-cluster-clarity"><i class="fa fa-check"></i><b>5.1</b> Omit some noise points for more cluster clarity</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cluster-refinement.html"><a href="cluster-refinement.html"><i class="fa fa-check"></i><b>6</b> Cluster Refinement</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cluster-refinement.html"><a href="cluster-refinement.html#refinement-idea-1-clustering-the-centroids"><i class="fa fa-check"></i><b>6.1</b> Refinement Idea 1: Clustering the centroids</a>
<ul>
<li class="chapter" data-level="" data-path="cluster-refinement.html"><a href="cluster-refinement.html#topic-keywords-for-clusters"><i class="fa fa-check"></i>Topic Keywords for Clusters</a></li>
<li class="chapter" data-level="" data-path="cluster-refinement.html"><a href="cluster-refinement.html#cluster-summarization"><i class="fa fa-check"></i>Cluster Summarization</a></li>
<li class="chapter" data-level="" data-path="cluster-refinement.html"><a href="cluster-refinement.html#visualization-of-refined-clusters"><i class="fa fa-check"></i>Visualization of Refined Clusters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="umap-of-full-sparse-matrix-in-python.html"><a href="umap-of-full-sparse-matrix-in-python.html"><i class="fa fa-check"></i><b>7</b> UMAP of Full Sparse Matrix in Python</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">21,578 Reuters’ Newswires</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cluster-refinement" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Cluster Refinement</h1>
<p>Problem with our initial clustering: Many medium-big clusters get broken up even though they seem nicely separated on the UMAP projection.<br />
</p>
<p>Two ideas for potential refinement:<br />
1. Run the clustering again on centroids of clusters<br />
2. <strong>Take all the existing clusters as single documents (i.e. paste all documents in a cluster together into single document for each cluster) – repeat this process.</strong> I think this is a nice idea but I don’t believe I’ll have time to play with it.<br />
</p>
<p>The first idea is easier so we’ll start there:</p>
<div id="refinement-idea-1-clustering-the-centroids" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Refinement Idea 1: Clustering the centroids</h2>
<div id="topic-keywords-for-clusters" class="section level3 unnumbered">
<h3>Topic Keywords for Clusters</h3>
<p>Get top words for further visualization and pile all documents in a cluster into one giant document for the purposes of summarization.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="cluster-refinement.html#cb14-1" aria-hidden="true" tabindex="-1"></a>top.words<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb14-2"><a href="cluster-refinement.html#cb14-2" aria-hidden="true" tabindex="-1"></a>cluster.docs <span class="ot">=</span> <span class="fu">vector</span>()</span>
<span id="cb14-3"><a href="cluster-refinement.html#cb14-3" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,k,<span class="dv">2</span>)</span>
<span id="cb14-4"><a href="cluster-refinement.html#cb14-4" aria-hidden="true" tabindex="-1"></a>mem<span class="ot">=</span><span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow=</span>n,<span class="at">ncol=</span>k)</span>
<span id="cb14-5"><a href="cluster-refinement.html#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="cluster-refinement.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb14-7"><a href="cluster-refinement.html#cb14-7" aria-hidden="true" tabindex="-1"></a>  mem[,i] <span class="ot">=</span> clus<span class="sc">$</span>cluster <span class="sc">==</span>i</span>
<span id="cb14-8"><a href="cluster-refinement.html#cb14-8" aria-hidden="true" tabindex="-1"></a>  tdmi <span class="ot">=</span> tfidf_tdm[,mem[,i]]</span>
<span id="cb14-9"><a href="cluster-refinement.html#cb14-9" aria-hidden="true" tabindex="-1"></a>  rs <span class="ot">=</span> <span class="fu">row_sums</span>(tdmi)</span>
<span id="cb14-10"><a href="cluster-refinement.html#cb14-10" aria-hidden="true" tabindex="-1"></a>  top.words[[i]] <span class="ot">=</span> <span class="fu">names</span>(rs[<span class="fu">order</span>(rs,<span class="at">decreasing=</span>T)])[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb14-11"><a href="cluster-refinement.html#cb14-11" aria-hidden="true" tabindex="-1"></a>  cluster.docs[i] <span class="ot">=</span> <span class="fu">paste</span>(raw_text[clus<span class="sc">$</span>cluster <span class="sc">==</span>i], <span class="at">sep=</span><span class="st">&#39;&#39;</span>, <span class="at">collapse=</span><span class="st">&#39; &#39;</span>)</span>
<span id="cb14-12"><a href="cluster-refinement.html#cb14-12" aria-hidden="true" tabindex="-1"></a>  centroids[i,]<span class="ot">=</span><span class="fu">colMeans</span>(svd_ump[clus<span class="sc">$</span>cluster <span class="sc">==</span>i,])</span>
<span id="cb14-13"><a href="cluster-refinement.html#cb14-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-14"><a href="cluster-refinement.html#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="cluster-refinement.html#cb14-15" aria-hidden="true" tabindex="-1"></a>displayWords<span class="ot">=</span><span class="fu">vector</span>()</span>
<span id="cb14-16"><a href="cluster-refinement.html#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){displayWords[i] <span class="ot">=</span> <span class="fu">paste</span>(top.words[[i]][<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>] , <span class="at">sep=</span><span class="st">&#39; &#39;</span>, <span class="at">collapse=</span><span class="st">&#39;&lt;br&gt;&#39;</span>)}</span></code></pre></div>
</div>
<div id="cluster-summarization" class="section level3 unnumbered">
<h3>Cluster Summarization</h3>
<p>To qualitatively evaluate our meta-clustering via centroids on the visualization, we’ll create some naive cluster summaries to display in the plot using the eigenvector centralities of the graph induced by cosine similarity between sentences in the clusters.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="cluster-refinement.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SummarySentences=vector()</span></span>
<span id="cb15-2"><a href="cluster-refinement.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:k){</span></span>
<span id="cb15-3"><a href="cluster-refinement.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># t=cluster.docs[i]</span></span>
<span id="cb15-4"><a href="cluster-refinement.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># t = gsub(&quot;&lt;br&gt;&quot;, &quot; &quot;, t, fixed =T)</span></span>
<span id="cb15-5"><a href="cluster-refinement.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change alternative sentence-ending punctuation to &#39;.&#39;</span></span>
<span id="cb15-6"><a href="cluster-refinement.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># t = gsub(&quot;\\?&quot;, &quot;.&quot;, t)</span></span>
<span id="cb15-7"><a href="cluster-refinement.html#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># t = gsub(&quot;\\!&quot;, &quot;.&quot;, t)</span></span>
<span id="cb15-8"><a href="cluster-refinement.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Split by sentence</span></span>
<span id="cb15-9"><a href="cluster-refinement.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># t2 = strsplit(t, &quot;.&quot;,fixed=TRUE)</span></span>
<span id="cb15-10"><a href="cluster-refinement.html#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># corpus &lt;- Corpus(VectorSource(as.data.frame(t2)[,1]))</span></span>
<span id="cb15-11"><a href="cluster-refinement.html#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove stop words, numbers and stem</span></span>
<span id="cb15-12"><a href="cluster-refinement.html#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># corpus = tm_map(corpus,removeWords,c(stopwords(&quot;en&quot;),&#39;reuter&#39;, &#39;dlrs&#39;, &#39;mln&#39;, &#39;said&#39;,&#39;will&#39;, &#39;year&#39;, &#39;compani&#39;,&#39;pct&#39;,&#39;corp&#39;))</span></span>
<span id="cb15-13"><a href="cluster-refinement.html#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># corpus = tm_map(corpus,removeNumbers)</span></span>
<span id="cb15-14"><a href="cluster-refinement.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># corpus = tm_map(corpus,stemDocument)</span></span>
<span id="cb15-15"><a href="cluster-refinement.html#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ########################################################################</span></span>
<span id="cb15-16"><a href="cluster-refinement.html#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove empty documents that appear after removal of stopwords and numbers</span></span>
<span id="cb15-17"><a href="cluster-refinement.html#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># td1 = TermDocumentMatrix(corpus)</span></span>
<span id="cb15-18"><a href="cluster-refinement.html#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># empty.cols = col_sums(td1)==0</span></span>
<span id="cb15-19"><a href="cluster-refinement.html#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co"># td1 = td1[,!empty.cols]</span></span>
<span id="cb15-20"><a href="cluster-refinement.html#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># raw=unlist(t2)[!empty.cols]</span></span>
<span id="cb15-21"><a href="cluster-refinement.html#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># if(length(empty.cols)&gt;0){corpus = corpus[!empty.cols]}</span></span>
<span id="cb15-22"><a href="cluster-refinement.html#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co"># td = weightTfIdf(td1,normalize=T)</span></span>
<span id="cb15-23"><a href="cluster-refinement.html#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># tdm_norm = apply(td, 2, function(x){x/c(sqrt(t(x)%*%x))})</span></span>
<span id="cb15-24"><a href="cluster-refinement.html#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># tdm_norm = as(tdm_norm,&quot;sparseMatrix&quot;)</span></span>
<span id="cb15-25"><a href="cluster-refinement.html#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # Cosine similarity</span></span>
<span id="cb15-26"><a href="cluster-refinement.html#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co"># C=t(tdm_norm)%*%tdm_norm</span></span>
<span id="cb15-27"><a href="cluster-refinement.html#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove self loops</span></span>
<span id="cb15-28"><a href="cluster-refinement.html#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># C[C&gt;0.9999999] = 0</span></span>
<span id="cb15-29"><a href="cluster-refinement.html#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co"># g = graph_from_adjacency_matrix(C, weighted = T)</span></span>
<span id="cb15-30"><a href="cluster-refinement.html#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co"># j=order(eigen_centrality(g)$vector,decreasing=T)</span></span>
<span id="cb15-31"><a href="cluster-refinement.html#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co"># SummarySentences[i] = paste(raw[j[1:5]], sep= &#39; &#39;,collapse=&#39;&lt;br&gt;&#39;)</span></span>
<span id="cb15-32"><a href="cluster-refinement.html#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb15-33"><a href="cluster-refinement.html#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># save(SummarySentences, file=&#39;docs/final_data_plots/SummarySentences.RData&#39;)</span></span>
<span id="cb15-34"><a href="cluster-refinement.html#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;docs/final_data_plots/SummarySentences.RData&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="cluster-refinement.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cen_clus = hdbscan(centroids, 3) # Down to 81 Clusters...Looks Pretty Good. </span></span>
<span id="cb16-2"><a href="cluster-refinement.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># save(cen_clus,file=&#39;docs/final_data_plots/cen_clus.RData&#39;)</span></span>
<span id="cb16-3"><a href="cluster-refinement.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;docs/final_data_plots/cen_clus.RData&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="cluster-refinement.html#cb17-1" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">mode =</span> <span class="st">&#39;markers&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="cluster-refinement.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> centroids[,<span class="dv">1</span>],</span>
<span id="cb17-3"><a href="cluster-refinement.html#cb17-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> centroids[,<span class="dv">2</span>],</span>
<span id="cb17-4"><a href="cluster-refinement.html#cb17-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste</span>(<span class="st">&#39;Key Words:&#39;</span>, displayWords,<span class="st">&quot;&lt;br&gt;Cluster Number: &quot;</span>, cen_clus<span class="sc">$</span>cluster,</span>
<span id="cb17-5"><a href="cluster-refinement.html#cb17-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;&lt;br&gt;Summary Sentences: &quot;</span>, SummarySentences),</span>
<span id="cb17-6"><a href="cluster-refinement.html#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="fu">factor</span>(cen_clus<span class="sc">$</span>cluster),</span>
<span id="cb17-7"><a href="cluster-refinement.html#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">marker=</span><span class="fu">list</span>( <span class="at">opacity=</span><span class="fl">0.6</span>),</span>
<span id="cb17-8"><a href="cluster-refinement.html#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">showlegend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-9"><a href="cluster-refinement.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWidget</span>(fig, <span class="st">&quot;docs/Centroid_Clus.html&quot;</span>)</span></code></pre></div>
<p><a href="https://shainarace.github.io/Reuters/Centroid_Clus.html">Full Page Visualization</a></p>
<p>Now we just need a function that maps the new centroid clustering back to the original points. Essentially one line of code in R, thanks to subsetting functionality (final line of function <code>remapClusters</code> below) but with the minor problem that noise points create an extra cluster. We simply add the noise cluster to the vector as cluster number <code>k+1</code>, and give it a value of <code>0</code> similar to the noise points. This creates some real problems with noise points.</p>
<p><em>Additional thought</em> (not implemented) leave the noise points IN and cluster them with the centroids. This is a good idea because it allows points that were previously labeled as noise to potentially join a cluster of nearby centroids.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="cluster-refinement.html#cb18-1" aria-hidden="true" tabindex="-1"></a>remapClusters <span class="ot">=</span> <span class="cf">function</span>(cen_clus,clus){</span>
<span id="cb18-2"><a href="cluster-refinement.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">=</span> <span class="fu">length</span>(clus<span class="sc">$</span>cluster_scores)</span>
<span id="cb18-3"><a href="cluster-refinement.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  c<span class="ot">=</span><span class="fu">as.vector</span>(clus<span class="sc">$</span>cluster)</span>
<span id="cb18-4"><a href="cluster-refinement.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  c[c<span class="sc">==</span><span class="dv">0</span>]<span class="ot">=</span>k<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb18-5"><a href="cluster-refinement.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  cc<span class="ot">=</span><span class="fu">as.vector</span>(cen_clus<span class="sc">$</span>cluster)</span>
<span id="cb18-6"><a href="cluster-refinement.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  cc[k<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb18-7"><a href="cluster-refinement.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  new <span class="ot">=</span> cc[c]</span>
<span id="cb18-8"><a href="cluster-refinement.html#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(new)</span>
<span id="cb18-9"><a href="cluster-refinement.html#cb18-9" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="visualization-of-refined-clusters" class="section level3 unnumbered">
<h3>Visualization of Refined Clusters</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="cluster-refinement.html#cb19-1" aria-hidden="true" tabindex="-1"></a>newclusters <span class="ot">=</span> <span class="fu">remapClusters</span>(cen_clus, clus) </span>
<span id="cb19-2"><a href="cluster-refinement.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="cluster-refinement.html#cb19-3" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">mode =</span> <span class="st">&#39;markers&#39;</span>)</span>
<span id="cb19-4"><a href="cluster-refinement.html#cb19-4" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="cluster-refinement.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb19-6"><a href="cluster-refinement.html#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> svd_ump[,<span class="dv">1</span>],</span>
<span id="cb19-7"><a href="cluster-refinement.html#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> svd_ump[,<span class="dv">2</span>],</span>
<span id="cb19-8"><a href="cluster-refinement.html#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste</span>(<span class="st">&#39;Heading:&#39;</span>, head ,<span class="st">&quot;&lt;br&gt;Text: &quot;</span>, raw_text ,<span class="st">&quot;&lt;br&gt;Original Cluster Number: &quot;</span>, clusters, <span class="st">&quot;&lt;br&gt;Centroid Cluster Number:&quot;</span>, newclusters ),</span>
<span id="cb19-9"><a href="cluster-refinement.html#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">hoverinfo =</span> <span class="st">&#39;text&#39;</span>,</span>
<span id="cb19-10"><a href="cluster-refinement.html#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">factor</span>(newclusters),</span>
<span id="cb19-11"><a href="cluster-refinement.html#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker=</span><span class="fu">list</span>(<span class="at">opacity=</span><span class="fl">0.6</span>),</span>
<span id="cb19-12"><a href="cluster-refinement.html#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> F</span>
<span id="cb19-13"><a href="cluster-refinement.html#cb19-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-14"><a href="cluster-refinement.html#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="cluster-refinement.html#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># saveWidget(fig, &quot;docs/All_centroid_refined_clusters.html&quot;)</span></span></code></pre></div>
<p><a href="https://shainarace.github.io/Reuters/All_centroid_refined_clusters.html">Full Page Visualization</a></p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-grand-visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="umap-of-full-sparse-matrix-in-python.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"toc": null
}
});
});
</script>

</body>

</html>
